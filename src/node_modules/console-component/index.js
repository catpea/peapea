const { Terminal } = require("xterm");
const { FitAddon } = require("xterm-addon-fit");
const { WebLinksAddon } = require("xterm-addon-web-links");
const { SearchAddon } = require("xterm-addon-search");

module.exports = function () {
  return component;
};

function component(container, componentState) {

  const term = new Terminal();
  const searchAddon = new SearchAddon();
  term.loadAddon(searchAddon);
  // searchAddon.findNext('foo');

  const fitAddon = new FitAddon();
  term.loadAddon(new WebLinksAddon());
  term.loadAddon(fitAddon);

  term.onKey(({ key, ev }) => {
    console.log(key.charCodeAt(0));
    if (key.charCodeAt(0) == 13) term.write("\n");
    term.write(key);
  });

  container.on( 'open', function(){
    term.open(container.element);
    term.write("Hello from \x1B[1;3;31mhttp://xterm.js\x1B[0m $ ");
    fitAddon.fit();
  });

  container.on( 'initialised', function(){
    fitAddon.fit();
  });

  container.on( 'resize', function(){
    fitAddon.fit();
  });

}
